std::string source = "mode=0\n"
"cur0=0\n"
"cur1=0\n"
"\n"
"\n"
"showcur(0)\n"
"startinput()\n"
"modeLabel = {\n"
"    \"Track\",\n"
"    \"Pattern\",\n"
"    \"Insturument\",\n"
"}\n"
"\n"
"-- 音符を周波数に変換する関数\n"
"function note2freq(n)\n"
"    concert_pitch = 440;\n"
"    f = concert_pitch * 2 ^ ((n - 69)/12)\n"
"    return int(f)\n"
"end\n"
"\n"
"-- トラックエディターの描画関数\n"
"function TrackEditor()\n"
"    print(\"FRM FM1 FM2 FM3 FM4 WT5 WT6\",16,4,rgb(192,255,192))\n"
"    rectb(15,19+(cur0//6%16)*16,209,12,250)\n"
"    rect(47+(cur0%6)*32,19+(cur0//6%16)*16,17,12,250)\n"
"    for y=0,15 do\n"
"        print(string.format(\"%02X\",int(math.floor(cur0//96)*16+y)),16,20+y*16,rgb(192,192,255))\n"
"        for x=0,5 do\n"
"            print(string.format(\"%02X\",peek(int(0x0F000+math.floor(cur0//96)*96+y*6+x))),48+x*32,20+y*16,rgb(255,255,255))\n"
"        end\n"
"    end\n"
"    --print(\"mouse:(\"..mx..\",\"..my..\",\"..mb..\")\",mx,my,255)\n"
"end\n"
"\n"
"-- パターンエディターの描画関数\n"
"function PatternEditor()\n"
"    notes=\"C-C#D-D#E-F-F#G-G#A-A#B-\"\n"
"    print(\"ROW NOTE INST -EFFECT-\",16,4,rgb(192,255,192))\n"
"    rectb(15,19+(cur1//4%16)*16,185,12,250)\n"
"    rect(47+(cur1%4)*40,19+(cur1//4%16)*16,33,12,250)\n"
"    for y=0,15 do\n"
"        print(string.format(\"%02X\",int(math.floor(cur1//64)*16+y)),16,20+y*16,rgb(192,192,255))\n"
"        note=peek(cur0*256+cur1//64*64+y*4)\n"
"        if note==0 then\n"
"            print(\"...\",48,20+y*16,rgb(255,255,255))\n"
"        elseif note==255 then\n"
"            print(\"===\",rgb(255,255,255))\n"
"        else\n"
"            print(string.sub(notes,note*2%24+1,note*2%24+2)..note//12,48,20+y*16,rgb(255,255,255))\n"
"        end\n"
"        note=peek(cur0*256+cur1//64*64+y*4+1)\n"
"        print(string.format(\"%02X\",note),88,20+y*16,rgb(255,255,255))\n"
"        effects=\"....VOLU\"\n"
"        note=peek(cur0*256+cur1//64*64+y*4+2)\n"
"        print(string.sub(effects,note*4+1,note*4+4),128,20+y*16,rgb(255,255,255))\n"
"        note=peek(cur0*256+cur1//64*64+y*4+3)\n"
"        print(string.format(\"%02X\",note),168,20+y*16,rgb(255,255,255))\n"
"    end\n"
"end\n"
"\n"
"-- インストゥルメントエディターの描画関数\n"
"function InstEditor()\n"
"end\n"
"\n"
"-- カーソルの描画関数\n"
"function drawcur()\n"
"    mx,my,mb=mouse()\n"
"    for y=-1,1 do\n"
"        for x=-1,1 do\n"
"            line(mx+x,my+y,mx+8+x,my+y,0)\n"
"            line(mx+x,my+y,mx+x,my+8+y,0)\n"
"            line(mx+x,my+y,mx+16+x,my+16+y,0)\n"
"        end\n"
"    end\n"
"    line(mx,my,mx+8,my,255)\n"
"    line(mx,my,mx,my+8,255)\n"
"    line(mx,my,mx+16,my+16,255)\n"
"    \n"
"end\n"
"\n"
"-- メインループ関数\n"
"function LOOP()\n"
"    cls(0)\n"
"    rect(0,275,384,13,255)\n"
"    if mode == 0 then\n"
"        TrackEditor()\n"
"        print(modeLabel[mode+1],1,276,0)\n"
"    end\n"
"    if mode == 1 then\n"
"        PatternEditor()\n"
"        print(modeLabel[mode+1]..\" \"..string.format(\"%02X\",cur0),1,276,0)\n"
"    end\n"
"    if mode == 2 then\n"
"        InstEditor()\n"
"        print(modeLabel[mode+1]..\" \"..string.format(\"%02X\",cur0),1,276,0)\n"
"    end  \n"
"    drawcur()\n"
"end\n"
"\n"
"inputchar = \"\"\n"
"\n"
"-- 入力処理関数\n"
"function ONINPUT(c)\n"
"    if mode == 0 then\n"
"        if tonumber(c,16) ~= nil then\n"
"            inputchar = inputchar .. c\n"
"            poke(int(0x0F000+cur0),tonumber(inputchar,16))\n"
"        else\n"
"        end\n"
"        if #inputchar == 2 then\n"
"            inputchar = \"\"\n"
"        end\n"
"    end\n"
"    if mode == 1 then\n"
"        if cur1%4 == 0 then\n"
"            if string.find(\"qwertyu\",c) then\n"
"                ind = string.find(\"qwertyu\",c)\n"
"                local notes = {0,2,4,5,7,9,11}\n"
"                poke(cur0*256+cur1,(peek(cur0*256+cur1)//12)*12+notes[ind])\n"
"            elseif string.find(\"0123456789\",c) then  \n"
"                ind = string.find(\"0123456789\",c)-1\n"
"                poke(cur0*256+cur1,peek(cur0*256+cur1)%12+ind*12)\n"
"            end\n"
"        end\n"
"    end\n"
"end\n"
"\n"
"-- キーダウン処理関数\n"
"function ONKEYDOWN(k)\n"
"    if mode == 0 then\n"
"        if to_key_name(k) == \"Up\" then\n"
"            cur0=(cur0-6)%1536\n"
"        end\n"
"        if to_key_name(k) == \"Down\" then\n"
"            cur0=(cur0+6)%1536\n"
"        end\n"
"        if to_key_name(k) == \"Left\" then\n"
"            cur0=(cur0-1)%1536\n"
"        end\n"
"        if to_key_name(k) == \"Right\" then\n"
"            cur0=(cur0+1)%1536\n"
"        end\n"
"    end\n"
"    if mode == 1 then\n"
"        if to_key_name(k) == \"Up\" then\n"
"            cur1=(cur1-4)%256\n"
"        end\n"
"        if to_key_name(k) == \"Down\" then\n"
"            cur1=(cur1+4)%256\n"
"        end\n"
"        if to_key_name(k) == \"Left\" then\n"
"            cur1=(cur1-1)%256\n"
"        end\n"
"        if to_key_name(k) == \"Right\" then\n"
"            cur1=(cur1+1)%256\n"
"        end\n"
"        if to_key_name(k) == \"S\" then\n"
"            cur0=(cur0-1)%256\n"
"        end\n"
"        if to_key_name(k) == \"X\" then\n"
"            cur0=(cur0+1)%256\n"
"        end\n"
"    end\n"
"    if to_key_name(k) == \"Z\" then\n"
"\n"
"        mode=(mode+1)%3\n"
"\n"
"    end\n"
"end\n"
"\n";